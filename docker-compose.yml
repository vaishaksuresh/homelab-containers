version: '3.8'

services:
  adguard:
    image: adguard/adguardhome:latest
    container_name: adguardhome
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - NET_RAW
      - NET_BIND_SERVICE
    volumes:
      - ./adguardhome/workdir:/opt/adguardhome/work
      - ./adguardhome/confdir:/opt/adguardhome/conf
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.30

  pihole:
    image: pihole/pihole:latest
    container_name: pihole-docker
    restart: unless-stopped
    environment:
      TZ: 'America/Los_Angeles'
      WEBPASSWORD: 'changeme'
    volumes:
      - ./pihole/etc-pihole:/etc/pihole
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.31

  nginx-proxy:
    image: jc21/nginx-proxy-manager:latest
    container_name: nginx-proxy-manager
    restart: unless-stopped
    volumes:
      - ./nginx-proxy-manager/data:/data
      - ./nginx-proxy-manager/letsencrypt:/etc/letsencrypt
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.200

  syncthing:
    image: linuxserver/syncthing:latest
    container_name: Syncthing
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Los_Angeles
    volumes:
      - ./syncthing/config:/config
      - /share/CACHEDEV1_DATA/Syncthing:/data
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.50

  watchtower:
    image: containrrr/watchtower:latest
    container_name: watchtower
    restart: unless-stopped
    environment:
      # Discord notifications
      - WATCHTOWER_NOTIFICATIONS=shoutrrr
      - WATCHTOWER_NOTIFICATION_URL=<endpoint>
      - WATCHTOWER_NOTIFICATIONS_LEVEL=info
      - WATCHTOWER_NOTIFICATION_TITLE= Watchtower Homelab Updates - Kryptonite

      # Update settings
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_INCLUDE_RESTARTING=true
      - WATCHTOWER_INCLUDE_STOPPED=false
      - WATCHTOWER_SCHEDULE=0 0 4 * * *  # 4 AM daily
      - TZ=America/Los_Angeles
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.254

  home-assistant:
    image: ghcr.io/home-assistant/home-assistant:stable
    container_name: home-assistant
    restart: unless-stopped
    privileged: true
    volumes:
      - ./home-assistant/config:/config
      - /etc/localtime:/etc/localtime:ro
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.123

  homebridge:
    image: homebridge/homebridge:latest
    container_name: homebridge
    restart: unless-stopped
    volumes:
      - ./homebridge:/homebridge
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.124
  # ============================================
  # REMOTE ACCESS
  # ============================================
  rustdesk-hbbs:
    image: rustdesk/rustdesk-server:latest
    container_name: rustdesk-hbbs
    restart: unless-stopped
    command: hbbs -r 10.0.20.151:21117
    volumes:
      - ./rustdesk/hbbs:/root
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.150

  rustdesk-hbbr:
    image: rustdesk/rustdesk-server:latest
    container_name: rustdesk-hbbr
    restart: unless-stopped
    command: hbbr
    volumes:
      - ./rustdesk/hbbr:/root
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.151
  # ============================================
  # MONITORING & DASHBOARDS
  # ============================================
  homarr:
    image: ghcr.io/ajnart/homarr:latest
    container_name: homarr
    restart: unless-stopped
    environment:
      - TZ=America/Los_Angeles
    volumes:
      - ./homarr/configs:/app/data/configs
      - ./homarr/icons:/app/public/icons
      - ./homarr/data:/data
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.60

  uptime-kuma:
    image: louislam/uptime-kuma:latest
    container_name: uptime-kuma
    restart: unless-stopped
    volumes:
      - ./uptime-kuma:/app/data
    networks:
      macvlan_services:
        ipv4_address: 10.0.20.61


networks:
  macvlan_services:
    driver: macvlan
    driver_opts:
      parent: eth0
    ipam:
      config:
        - subnet: 10.0.20.0/24
          gateway: 10.0.20.1
